<div
  class="relative flex size-full min-h-screen flex-col bg-white justify-between group/design-root overflow-x-hidden"
  style='--radio-dot-svg: url(&apos;data:image/svg+xml,%3csvg viewBox=%270 0 16 16%27 fill=%27rgb(18,20,23)%27 xmlns=%27http://www.w3.org/2000/svg%27%3e%3ccircle cx=%278%27 cy=%278%27 r=%273%27/%3e%3c/svg%3e&apos;); font-family: "Public Sans", "Noto Sans", sans-serif;'
>
  <div *ngIf="!errorMessage; else errorState">
    <div class="flex items-center bg-white p-4 pb-2 justify-between">
      <div class="text-[#121417] flex size-12 shrink-0 items-center" data-icon="ArrowLeft" data-size="24px" data-weight="regular">
        <svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" fill="currentColor" viewBox="0 0 256 256">
          <path d="M224,128a8,8,0,0,1-8,8H59.31l58.35,58.34a8,8,0,0,1-11.32,11.32l-72-72a8,8,0,0,1,0-11.32l72-72a8,8,0,0,1,11.32,11.32L59.31,120H216A8,8,0,0,1,224,128Z"></path>
        </svg>
      </div>
      <h2 class="text-[#121417] text-lg font-bold leading-tight tracking-[-0.015em] flex-1 text-center pr-12">Inserisci Lettura</h2>
    </div>

    <ng-container *ngIf="userData; else loadingUser">
      <div class="flex max-w-[480px] flex-wrap items-end gap-4 px-4 py-3">
        <label class="flex flex-col min-w-40 flex-1">
          <p class="text-[#121417] text-base font-medium leading-normal pb-2">Indirizzo di casa *</p>
          <input
            class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-xl text-[#121417] focus:outline-0 focus:ring-0 border-none bg-[#f1f2f4] focus:border-none h-14 placeholder:text-[#677583] p-4 text-base font-normal leading-normal"
            [(ngModel)]="homeAddress" name="homeAddress" required
          />
        </label>
      </div>
      <div class="flex max-w-[480px] flex-wrap items-end gap-4 px-4 py-3">
        <label class="flex flex-col min-w-40 flex-1">
          <p class="text-[#121417] text-base font-medium leading-normal pb-2">Punto di fornitura</p>
          <input
            class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-xl text-[#121417] focus:outline-0 focus:ring-0 border-none bg-[#f1f2f4] focus:border-none h-14 placeholder:text-[#677583] p-4 text-base font-normal leading-normal"
            [(ngModel)]="supplyPoint" name="supplyPoint"
          />
        </label>
      </div>
      <div class="flex max-w-[480px] flex-wrap items-end gap-4 px-4 py-3">
        <label class="flex flex-col min-w-40 flex-1">
          <p class="text-[#121417] text-base font-medium leading-normal pb-2">Numero di serie del contatore</p>
          <input
            class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-xl text-[#121417] focus:outline-0 focus:ring-0 border-none bg-[#f1f2f4] focus:border-none h-14 placeholder:text-[#677583] p-4 text-base font-normal leading-normal"
            [(ngModel)]="meterSerialNumber" name="meterSerialNumber"
          />
        </label>
      </div>
      <div class="flex max-w-[480px] flex-wrap items-end gap-4 px-4 py-3">
        <label class="flex flex-col min-w-40 flex-1">
          <p class="text-[#121417] text-base font-medium leading-normal pb-2">Descrizione della posizione del contatore</p>
          <textarea
            class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-xl text-[#121417] focus:outline-0 focus:ring-0 border-none bg-[#f1f2f4] focus:border-none min-h-36 placeholder:text-[#677583] p-4 text-base font-normal leading-normal"
            [(ngModel)]="meterLocationDescription" name="meterLocationDescription"
          ></textarea>
        </label>
      </div>
    </ng-container>
    <ng-template #loadingUser><p class="px-4 py-3">Caricamento dati utente...</p></ng-template>

    <h3 class="text-[#121417] text-lg font-bold leading-tight tracking-[-0.015em] px-4 pb-2 pt-4">Guida alla lettura</h3>
    <div class="flex w-full grow bg-white @container py-3">
      <div class="w-full gap-1 overflow-hidden bg-white @[480px]:gap-2 aspect-[3/2] flex">
        <div
          class="w-full bg-center bg-no-repeat bg-cover aspect-auto rounded-none flex-1"
          style='background-image: url("https://lh3.googleusercontent.com/aida-public/AB6AXuDVYj08r6IKoGteGSHouG5G4B7RgrS_wVAChJFgH0aaqGIvoQl0uIS7CiAUpSzu6ka9YimQ9KMI1GJQHLGrZPyJg2YI3tyrMqdbAZDaLQkDpR8xbCxDyO-pKUGbcEHAs1HauaPjFNZYhY25YwYUSojBI_c7Xs-VidqidswJht0Gcu1HKKlBGcRoRx6CCXH-ZO_nYkxX8Y5paPdSJCeDNoHGivqX-bkDP_2A9slW9xlcEnfaRZqYYrMI5xvG0SZJijrtPduCmvD0HOkR");'
        ></div>
      </div>
    </div>
    <div class="flex max-w-[480px] flex-wrap items-end gap-4 px-4 py-3">
      <label class="flex flex-col min-w-40 flex-1">
        <p class="text-[#121417] text-base font-medium leading-normal pb-2">Lettura *</p>
        <input
          placeholder="Lettura"
          class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-xl text-[#121417] focus:outline-0 focus:ring-0 border-none bg-[#f1f2f4] focus:border-none h-14 placeholder:text-[#677583] p-4 text-base font-normal leading-normal"
          [(ngModel)]="reading" name="reading" required
        />
      </label>
    </div>

    <ng-container *ngIf="waterFact; else loadingWaterFact">
      <h2 class="text-[#121417] text-lg font-bold leading-tight tracking-[-0.015em] px-4 text-left pb-2 pt-4">Curiosità sull'acqua</h2>
      <p class="text-[#121417] text-base font-normal leading-normal pb-3 pt-1 px-4">
        {{ waterFact.quiz_question }}
      </p>
      <div class="flex flex-col gap-3 p-4">
        <label *ngFor="let option of waterFact.quiz_options" class="flex items-center gap-4 rounded-xl border border-solid border-[#dde0e4] p-[15px]">
          <input
            type="radio"
            class="h-5 w-5 border-2 border-[#dde0e4] bg-transparent text-transparent checked:border-[#121417] checked:bg-[image:--radio-dot-svg] focus:outline-none focus:ring-0 focus:ring-offset-0 checked:focus:border-[#121417]"
            name="waterFactRadio"
            [value]="option"
            [(ngModel)]="selectedWaterFactAnswer"
            (change)="waterFactAnswerChecked = false; isWaterFactAnswerCorrect = null;"
          />
          <div class="flex grow flex-col"><p class="text-[#121417] text-sm font-medium leading-normal">{{ option }}</p></div>
        </label>
      </div>
      <div class="flex px-4 py-3">
        <button
          (click)="checkWaterFactAnswer()"
          [disabled]="!selectedWaterFactAnswer"
          class="flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-full h-10 px-4 flex-1 bg-[#f1f2f4] text-[#121417] text-sm font-bold leading-normal tracking-[0.015em] disabled:opacity-50"
        >
          <span class="truncate">Controlla la risposta</span>
        </button>
      </div>
      <div *ngIf="waterFactAnswerChecked && isWaterFactAnswerCorrect !== null" class="px-4 pb-3">
        <p *ngIf="isWaterFactAnswerCorrect" class="text-green-600 font-medium">Corretto!</p>
        <p *ngIf="!isWaterFactAnswerCorrect" class="text-red-600 font-medium">Sbagliato. La risposta corretta era: {{ waterFact.quiz_correct_answer }}</p>
      </div>
    </ng-container>
    <ng-template #loadingWaterFact><p class="px-4 py-3">Caricamento curiosità...</p></ng-template>

    <div class="flex justify-center">
      <div class="flex flex-1 gap-3 flex-wrap px-4 py-3 max-w-[480px] justify-center">
        <button
          (click)="skipAndSubmit()"
          [disabled]="!isFormValid"
          class="flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-full h-10 px-4 bg-[#d2e2f3] text-[#121417] grow text-sm font-bold disabled:opacity-50">
          <span class="truncate">Salta e Invia</span>
        </button>
        <button
          (click)="submitReading()"
          [disabled]="!isFormValid"
          class="flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-full h-10 px-4 bg-[#3490f3] text-white grow text-sm font-bold disabled:opacity-50">
          <span class="truncate">Invia Lettura</span>
        </button>
        <!-- Placeholder for the third button, if it's a distinct action -->
        <!-- <button (click)="handleInfoButton()" class="flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-full h-10 px-4 bg-transparent text-[#121417] grow">
          <span class="truncate">i</span>
        </button> -->
      </div>
    </div>
  </div>

  <ng-template #errorState>
    <div class="p-4 text-red-600">
      <p>Errore: {{ errorMessage }}</p>
      <button (click)="router.navigate(['/'])" class="mt-2 p-2 bg-gray-200 rounded">Ricarica</button>
    </div>
  </ng-template>

  <div> <!-- Sticky bottom navigation -->
    <div class="flex gap-2 border-t border-[#f1f2f4] bg-white px-4 pb-3 pt-2">
      <a routerLink="/home" [queryParams]="{ c_number: cNumber }" queryParamsHandling="merge" class="just flex flex-1 flex-col items-center justify-end gap-1 rounded-full text-[#121417]">
        <div class="text-[#121417] flex h-8 items-center justify-center" data-icon="House" data-size="24px" data-weight="fill">
          <svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" fill="currentColor" viewBox="0 0 256 256">
            <path d="M224,115.55V208a16,16,0,0,1-16,16H168a16,16,0,0,1-16-16V168a8,8,0,0,0-8-8H112a8,8,0,0,0-8,8v40a16,16,0,0,1-16,16H48a16,16,0,0,1-16-16V115.55a16,16,0,0,1,5.17-11.78l80-75.48.11-.11a16,16,0,0,1,21.53,0,1.14,1.14,0,0,0,.11.11l80,75.48A16,16,0,0,1,224,115.55Z"></path>
          </svg>
        </div>
        <p class="text-[#121417] text-xs font-medium leading-normal tracking-[0.015em]">Home</p>
      </a>
      <a routerLink="/assistenza1" [queryParams]="{ c_number: cNumber }" queryParamsHandling="merge" class="just flex flex-1 flex-col items-center justify-end gap-1 text-[#677583]">
        <div class="text-[#677583] flex h-8 items-center justify-center" data-icon="Question" data-size="24px" data-weight="regular">
          <svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" fill="currentColor" viewBox="0 0 256 256">
            <path d="M140,180a12,12,0,1,1-12-12A12,12,0,0,1,140,180ZM128,72c-22.06,0-40,16.15-40,36v4a8,8,0,0,0,16,0v-4c0-11,10.77-20,24-20s24,9,24,20-10.77,20-24,20a8,8,0,0,0-8,8v8a8,8,0,0,0,16,0v-.72c18.24-3.35,32-17.9,32-35.28C168,88.15,150.06,72,128,72Zm104,56A104,104,0,1,1,128,24,104.11,104.11,0,0,1,232,128Zm-16,0a88,88,0,1,0-88,88A88.1,88.1,0,0,0,216,128Z"></path>
          </svg>
        </div>
        <p class="text-[#677583] text-xs font-medium leading-normal tracking-[0.015em]">Aiuto</p>
      </a>
    </div>
    <div class="h-5 bg-white"></div>
  </div>
</div>
